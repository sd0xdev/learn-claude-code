═══════════════════════════════════════════════════════════════════
第 03 課：管理上下文
═══════════════════════════════════════════════════════════════════

## 什麼是上下文？

上下文是 Claude 在對話中能「看見」的所有內容——你的訊息、Claude 的回覆、讀取過的檔案、撰寫過的程式碼。這些全都存在於一個**上下文視窗**中，而它的大小是有限制的。

你可以把它想像成一塊白板。隨著你的工作，白板會逐漸被填滿。當它滿了，較早的內容會被清除以騰出空間給新內容。如果重要的細節被清除了，Claude 可能會遺忘你們先前討論過的事情。

## 為什麼這很重要

你正在進行一段深入的除錯工作。你已經分享了堆疊追蹤、解釋了架構、逐一檢視了檔案。然後 Claude 漏掉了你先前問過的某件事。

發生了什麼事？對話變得太長，早期的上下文被擠出去了。以下是管理上下文的方法。

## 關鍵指令

**`/context`** — 顯示你已使用了多少上下文視窗空間。

**`/compact`** — 將對話摘要成重點，釋放空間的同時保留重要的上下文。

**`/clear`** — 清除對話歷史紀錄並釋放上下文空間。

## 試試看

是時候為 Dungeons & Agents 新增房間了。

1. 執行 `/context` 查看你目前使用了多少上下文視窗空間。

2. 請 Claude 擴展房間系統：

   > 擴展地下城遊戲，新增更多房間。cave-entrance 已經存在於 data/rooms.json。新增 4 個相連的房間：
   >
   > - "narrow-tunnel"（入口往上）— 狹窄通道，出口：下、右、上、左
   > - "treasure-room"（通道往右）— 閃閃發光的密室，有金幣，出口：左
   > - "underground-lake"（通道往左）— 廣闘洞窟，有黑暗的水，出口：右、左
   > - "secret-garden"（通道往上）— 地底不可思議的花園，出口：下
   >
   > 更新 cave-entrance，新增往上到 narrow-tunnel 的出口。
   > 更新 game.js，讓 'look' 顯示目前房間的描述和出口，'go [方向]' 或方向鍵 (ArrowUp/Down/Left/Right) 可以移動。
   > 更新 ui/ui.js 中的 mapLayout 網格，顯示所有房間的正確位置。
   > 確保地圖和房間位置相符。

3. 測試遊戲：用 `go up`、方向鍵、`look` 來探索。

4. 再次執行 `/context`——注意使用量增加了。

隨著你新增更多功能：對話變長時使用 `/compact`，需要重新開始時使用 `/clear`。
